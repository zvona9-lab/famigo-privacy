name: Push worker cron (backup)

on:
  workflow_dispatch:

jobs:
  call-worker:
    runs-on: ubuntu-latest
    steps:
      - name: Call Supabase push-worker (backup manual)
        shell: bash
        run: |
          set -euo pipefail
          HOST="lfqomdihzsnrywqujwzw.supabase.co"
          URL="https://${HOST}/functions/v1/push-worker"

          HTTP_STATUS="$(
            curl -sS --show-error --location \
              --connect-timeout 15 --max-time 60 \
              -X POST "${URL}" \
              -H "Content-Type: application/json" \
              -H "Authorization: Bearer ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}" \
              -H "User-Agent: famigo-push-cron-backup/1.0" \
              -d '{}' \
              -w "%{http_code}"
          )"

          echo "HTTP_STATUS=${HTTP_STATUS}"
          if [[ "${HTTP_STATUS}" != "200" ]]; then
            echo "ERROR: push-worker returned HTTP ${HTTP_STATUS}"
            exit 1
          fi

          echo "OK"
